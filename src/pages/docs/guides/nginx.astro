---
import DocsLayout from '../../../layouts/DocsLayout.astro'
import CodeBlock from '../../../components/CodeBlock.astro'
---

<DocsLayout title="Nginx Reverse Proxy">
  <h1>Nginx Reverse Proxy</h1>

  <p class="lead text-xl text-neutral-600">
    Set up Nginx with SSL for production.
  </p>

  <h2>Install Nginx</h2>

  <CodeBlock
    lang="bash"
    code={`sudo apt update
sudo apt install nginx`}
  />

  <h2>Configure site</h2>

  <p>Create <code>/etc/nginx/sites-available/ender</code>:</p>

  <CodeBlock
    lang="nginx"
    filename="/etc/nginx/sites-available/ender"
    code={`server {
    listen 80;
    server_name sms.yourdomain.com;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl http2;
    server_name sms.yourdomain.com;

    ssl_certificate /etc/letsencrypt/live/sms.yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/sms.yourdomain.com/privkey.pem;

    # API
    location /api {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Dashboard
    location / {
        proxy_pass http://localhost:5173;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}`}
  />

  <h2>Enable site</h2>

  <CodeBlock
    lang="bash"
    code={`sudo ln -s /etc/nginx/sites-available/ender /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx`}
  />

  <h2>SSL with Certbot</h2>

  <CodeBlock
    lang="bash"
    code={`sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d sms.yourdomain.com`}
  />

  <h2>Related</h2>

  <ul>
    <li><a href="/docs/installation">Installation</a> - Full setup guide</li>
    <li><a href="/docs/guides/docker">Docker Guide</a> - Container setup</li>
  </ul>
</DocsLayout>
