---
import DocsLayout from '../../../layouts/DocsLayout.astro'
import CodeBlock from '../../../components/CodeBlock.astro'
---

<DocsLayout title="Message Status">
  <h1>Message Status</h1>

  <p class="lead text-xl text-neutral-600">
    Check the delivery status of sent messages.
  </p>

  <h2>Get message status</h2>

  <p>Messages are stored in the <code>sms_messages</code> PocketBase collection. Query a specific message by its ID:</p>

  <div class="not-prose my-6 p-4 bg-neutral-100 rounded-lg">
    <p class="text-sm font-mono">
      <span class="text-blue-600 font-semibold">GET</span>
      <span class="text-neutral-900 ml-2">/api/collections/sms_messages/records/:id</span>
    </p>
  </div>

  <h3>Example</h3>

  <CodeBlock
    lang="bash"
    code={`curl https://your-server.com/api/collections/sms_messages/records/MESSAGE_ID \\
  -H "Authorization: Bearer YOUR_JWT_TOKEN"`}
  />

  <h3>Response</h3>

  <CodeBlock
    lang="json"
    code={`{
  "id": "a1b2c3d4e5f6g7h",
  "collectionId": "sms_messages",
  "collectionName": "sms_messages",
  "status": "delivered",
  "to": "+1234567890",
  "body": "Your code is 123456",
  "message_type": "outgoing",
  "device": "x9y8z7w6v5u4t3s",
  "sent_at": "2024-01-15 10:30:02.000Z",
  "delivered_at": "2024-01-15 10:30:05.000Z",
  "error_message": "",
  "created": "2024-01-15 10:30:00.000Z",
  "updated": "2024-01-15 10:30:05.000Z"
}`}
  />

  <h2>Status values</h2>

  <table>
    <thead>
      <tr>
        <th>Status</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>pending</code></td>
        <td>Created, no device assigned</td>
      </tr>
      <tr>
        <td><code>assigned</code></td>
        <td>Device assigned, push notification sent</td>
      </tr>
      <tr>
        <td><code>sending</code></td>
        <td>Being processed by device</td>
      </tr>
      <tr>
        <td><code>sent</code></td>
        <td>Sent by device</td>
      </tr>
      <tr>
        <td><code>delivered</code></td>
        <td>Confirmed delivered</td>
      </tr>
      <tr>
        <td><code>failed</code></td>
        <td>Failed to send</td>
      </tr>
      <tr>
        <td><code>received</code></td>
        <td>Incoming SMS from an external sender</td>
      </tr>
    </tbody>
  </table>

  <h2>List messages</h2>

  <div class="not-prose my-6 p-4 bg-neutral-100 rounded-lg">
    <p class="text-sm font-mono">
      <span class="text-blue-600 font-semibold">GET</span>
      <span class="text-neutral-900 ml-2">/api/collections/sms_messages/records</span>
    </p>
  </div>

  <h3>Query parameters</h3>

  <p>Uses PocketBase's standard list API with filtering, sorting, and page-based pagination:</p>

  <table>
    <thead>
      <tr>
        <th>Parameter</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>filter</code></td>
        <td>PocketBase filter syntax (e.g., <code>status="sent"</code>)</td>
      </tr>
      <tr>
        <td><code>sort</code></td>
        <td>Sort field (e.g., <code>-created</code> for newest first)</td>
      </tr>
      <tr>
        <td><code>page</code></td>
        <td>Page number (default: 1)</td>
      </tr>
      <tr>
        <td><code>perPage</code></td>
        <td>Results per page (default: 30, max: 500)</td>
      </tr>
    </tbody>
  </table>

  <h3>Example</h3>

  <CodeBlock
    lang="bash"
    code={`curl "https://your-server.com/api/collections/sms_messages/records?filter=status='delivered'&sort=-created&perPage=20" \\
  -H "Authorization: Bearer YOUR_JWT_TOKEN"`}
  />

  <h2>Related</h2>

  <ul>
    <li><a href="/docs/api/webhooks">Webhooks</a> - Get status updates in real-time</li>
    <li><a href="/docs/api/send-sms">Send SMS</a> - Send messages</li>
  </ul>
</DocsLayout>
