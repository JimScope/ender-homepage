---
import DocsLayout from '../../../layouts/DocsLayout.astro'
import CodeBlock from '../../../components/CodeBlock.astro'
---

<DocsLayout title="Authentication">
  <h1>Authentication</h1>

  <p class="lead text-xl text-neutral-600">
    Authenticate API requests using API keys or JWT tokens.
  </p>

  <h2>API Keys</h2>

  <p>For server-to-server integrations, use an API key in the <code>X-API-Key</code> header:</p>

  <CodeBlock lang="bash" code="X-API-Key: ek_your_api_key_here" />

  <p>API keys (prefixed <code>ek_</code>) are created in the dashboard and can be used to send SMS and access the API without a user session.</p>

  <h2>JWT Authentication</h2>

  <p>For browser-based or session-based access, use PocketBase's built-in JWT authentication:</p>

  <CodeBlock lang="bash" code="Authorization: Bearer YOUR_JWT_TOKEN" />

  <p>Obtain a JWT token by authenticating via the PocketBase auth endpoints (<code>/api/collections/users/auth-with-password</code>).</p>

  <h2>Creating API keys</h2>

  <ol>
    <li>Log in to the Dashboard</li>
    <li>Go to Settings → API Keys</li>
    <li>Click "Create API Key"</li>
    <li>Copy the key immediately (it's only shown once on creation)</li>
  </ol>

  <h2>Key types</h2>

  <table>
    <thead>
      <tr>
        <th>Prefix</th>
        <th>Type</th>
        <th>Use for</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>ek_</code></td>
        <td>Integration key</td>
        <td>Server-to-server API calls (send SMS, etc.)</td>
      </tr>
      <tr>
        <td><code>dk_</code></td>
        <td>Device key</td>
        <td>Auto-generated for registered devices</td>
      </tr>
    </tbody>
  </table>

  <h2>Revoking keys</h2>

  <p>To revoke an API key:</p>

  <ol>
    <li>Go to Settings → API Keys</li>
    <li>Click the trash icon next to the key</li>
    <li>Confirm deletion</li>
  </ol>

  <div class="not-prose my-8 p-4 bg-red-50 border border-red-200 rounded-lg">
    <p class="text-red-800 text-sm">
      <strong>Security:</strong> Never expose API keys in client-side code or public repositories. Device keys (<code>dk_</code>) are auto-generated and only shown once when the device is first registered.
    </p>
  </div>

  <h2>Rate limits</h2>

  <p>Ender uses PocketBase's built-in rate limiter. The SMS send endpoint is limited to 30 requests per minute per user.</p>

  <table>
    <thead>
      <tr>
        <th>Endpoint</th>
        <th>Limit</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>POST /api/sms/send</td>
        <td>30 req/min</td>
      </tr>
      <tr>
        <td>Other endpoints</td>
        <td>PocketBase defaults</td>
      </tr>
    </tbody>
  </table>
</DocsLayout>
