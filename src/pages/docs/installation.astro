---
import DocsLayout from '../../layouts/DocsLayout.astro'
import CodeBlock from '../../components/CodeBlock.astro'
---

<DocsLayout title="Installation">
  <h1>Installation</h1>

  <p class="lead text-xl text-neutral-600">
    Deploy Ender on your own server for production use.
  </p>

  <div class="not-prose my-6 alert alert-info">
    <p>
      <strong>Don't want to self-host?</strong> Try <button onclick="openWaitlistModal()" class="text-accent hover:underline">Ender Cloud</button> â€” free plan available, paid plans from $0.99/month.
    </p>
  </div>

  <h2>Requirements</h2>

  <ul>
    <li>Linux server (Ubuntu 22.04+ recommended)</li>
    <li>Docker and Docker Compose v2</li>
    <li>At least 512MB RAM, 5GB disk</li>
    <li>Domain name with SSL certificate</li>
  </ul>

  <h2>Docker Compose (Recommended)</h2>

  <h3>1. Create docker-compose.yml</h3>

  <p>Create a new directory and add a <code>docker-compose.yml</code> file:</p>

  <CodeBlock
    lang="yaml"
    filename="docker-compose.yml"
    code={`services:
  app:
    image: ghcr.io/jimscope/ender:latest
    environment:
      - ENVIRONMENT=production
      - FIRST_SUPERUSER=\${FIRST_SUPERUSER}
      - FIRST_SUPERUSER_PASSWORD=\${FIRST_SUPERUSER_PASSWORD}
      - APP_URL=https://\${DOMAIN}
      - FRONTEND_URL=https://\${DOMAIN}
      - FIREBASE_SERVICE_ACCOUNT_JSON=\${FIREBASE_SERVICE_ACCOUNT_JSON}
      - SMTP_HOST=\${SMTP_HOST:-}
      - SMTP_PORT=\${SMTP_PORT:-}
      - SMTP_USERNAME=\${SMTP_USERNAME:-}
      - SMTP_PASSWORD=\${SMTP_PASSWORD:-}
    ports:
      - "8090:8090"
    volumes:
      - ender_data:/app/pb_data

volumes:
  ender_data:`}
  />

  <h3>2. Configure environment</h3>

  <p>Create a <code>.env</code> file in the same directory:</p>

  <CodeBlock
    lang="bash"
    filename=".env"
    code={`# Required
FIRST_SUPERUSER=admin@yourdomain.com
FIRST_SUPERUSER_PASSWORD=your-secure-password
DOMAIN=sms.yourdomain.com

# Firebase (required for push notifications to devices)
FIREBASE_SERVICE_ACCOUNT_JSON={"type":"service_account",...}

# SMTP (optional, for email features)
SMTP_HOST=smtp.yourdomain.com
SMTP_PORT=587
SMTP_USERNAME=noreply@yourdomain.com
SMTP_PASSWORD=your-smtp-password`}
  />

  <h3>3. Start the service</h3>

  <CodeBlock lang="bash" code="docker compose up -d" />

  <h3>4. Access the dashboard</h3>

  <p>Open the dashboard at <code>https://sms.yourdomain.com</code> (or <code>http://localhost:8090</code> if testing locally). Log in with the superuser credentials from your <code>.env</code> file. The PocketBase admin panel is available at <code>/_/</code>.</p>

  <h2>Reverse Proxy Setup</h2>

  <p>See <a href="/docs/guides/nginx">Nginx Reverse Proxy</a> for SSL termination and proxy configuration.</p>

  <h2>Environment Variables</h2>

  <table>
    <thead>
      <tr>
        <th>Variable</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>ENVIRONMENT</code></td>
        <td>Runtime environment (<code>local</code> or <code>production</code>)</td>
        <td>local</td>
      </tr>
      <tr>
        <td><code>FIRST_SUPERUSER</code></td>
        <td>Superuser email address</td>
        <td>admin@ender.app</td>
      </tr>
      <tr>
        <td><code>FIRST_SUPERUSER_PASSWORD</code></td>
        <td>Superuser password</td>
        <td>changethis</td>
      </tr>
      <tr>
        <td><code>APP_URL</code></td>
        <td>Public URL of the application</td>
        <td>http://localhost:8090</td>
      </tr>
      <tr>
        <td><code>FRONTEND_URL</code></td>
        <td>Public URL for frontend redirects</td>
        <td>http://localhost:5173</td>
      </tr>
      <tr>
        <td><code>FIREBASE_SERVICE_ACCOUNT_JSON</code></td>
        <td>Firebase service account JSON for FCM</td>
        <td>-</td>
      </tr>
      <tr>
        <td><code>WEBHOOK_ENCRYPTION_KEY</code></td>
        <td>AES key for webhook secret encryption</td>
        <td>-</td>
      </tr>
    </tbody>
  </table>

  <h2>Backup with Litestream</h2>

  <p>Ender uses SQLite as its embedded database. For continuous backup to S3-compatible storage, set these optional environment variables:</p>

  <CodeBlock
    lang="bash"
    code={`LITESTREAM_REPLICA_URL=s3://my-bucket/ender/data
LITESTREAM_ACCESS_KEY_ID=your-access-key
LITESTREAM_SECRET_ACCESS_KEY=your-secret-key`}
  />

  <p>When set, Litestream automatically streams WAL changes to your S3 bucket and restores on startup if needed.</p>

  <h2>Updates</h2>

  <p>To update to the latest version:</p>

  <CodeBlock
    lang="bash"
    code={`docker compose pull
docker compose up -d`}
  />

  <h2>Next steps</h2>

  <ul>
    <li><a href="/docs/android-app">Android App</a> - Set up your first device</li>
    <li><a href="/docs/usb-modems">USB Modems</a> - Connect USB GSM modems (Docker or standalone)</li>
    <li><a href="/docs/guides/nginx">Nginx Guide</a> - Configure SSL</li>
    <li><a href="/docs/guides/docker">Docker Guide</a> - Advanced configuration</li>
  </ul>
</DocsLayout>
